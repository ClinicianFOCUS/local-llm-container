services:
  llm-container:
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities:
                - gpu
    volumes:
      - ~/.cache/huggingface:/root/.cache/huggingface
      - ./models:/models
      - ./gemma-it.jinja:/gemma-it.jinja
    ports:
      - 2242:2242
    networks:
      - llm-network
    ipc: host
    image: alpindale/aphrodite-openai:latest
    command: --model /models/gemma-2b --chat-template /gemma-it.jinja
  caddy:
    image: caddy:latest
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
    ports:
      - 8080:80
      - 443:443
    networks:
      - llm-network
    depends_on:
      - llm-container

networks:
  llm-network:
    driver: bridge
